

<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<html>
    <head>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" type="text/css" href="css/css.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <title>NotMalware</title>
        <!-- checking cookie -->
        <%
            String userName = null;
            Cookie[] cookies = request.getCookies();
            if (cookies != null) {
                for (Cookie cookie : cookies) {
                    if (cookie.getName().equals("user")) {
                        userName = cookie.getValue();
                    }
                }
            }
            if (userName == null) {
                response.sendRedirect("Landing.jsp");
            }
        %>

        <script>
            // Function to change email-address
            function changeEmail() {
                // Get the username from the cookie
                var username = '<%=userName%>';
                // Double email input to prevent misspellings
                var email1 = document.getElementById('femail1');
                var email2 = document.getElementById('femail2');
                // Password to confirm the change
                var pass = document.getElementById('fpass');
                if (email1.value.length <= 0 || email2.value.length <= 0 || pass.value.length <= 0) {
                    alert("Form must be filled out");
                    return false;
                } else if (email1.value !== email2.value) {
                    alert("New emails do not match");
                    return false;
                }

                // Ajax call to the REST
                var string = email1.value;
                var curl = '/NotMalware/webresources/person/' + username + "/" + pass.value + "/email";
                $.ajax({
                    url: curl,
                    type: 'POST',
                    data: string,
                    contentType: 'text/plain',
                    async: false,
                    success: function () {
                        alert("Email changed");
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("Incorrect Password");
                    }
                });

                return true;
            }

            // Function to change password
            function changePass() {
                // Get the username from the cookie
                var username = '<%=userName%>';
                var pass = document.getElementById('fpass1');
                // Double password input to prevent misspellings
                var pass2 = document.getElementById('fpass2');
                var pass3 = document.getElementById('fpass3');
                if (pass.value.length <= 0 || pass2.value.length <= 0 || pass3.value.length <= 0) {
                    alert("Form must be filled out");
                    return false;
                } else if (pass2.value !== pass3.value) {
                    alert("New passwords do not match");
                    return false;
                }

                // Ajax call to REST
                var string = pass2.value;
                var curl = "/NotMalware/webresources/person/" + username + "/" + pass.value + "/password";
                $.ajax({
                    url: curl,
                    type: 'POST',
                    data: string,
                    contentType: 'text/plain',
                    async: false,
                    success: function (data) {
                        alert("Password changed");
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("Incorrect Password");
                    }
                });

                return true;
            }

            $(document).ready(function () {
            // Setting the topbar username and job
            var userName = '<%=userName%>';
                    var userp = document.getElementById("user");
                    userp.innerHTML = userName;
            });
        </script>

    </head>

    <body>


        <nav id="header" class="navbar navbar-default">
            <img src="css/img/logo.png" alt="Masterful design" id="logo">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbartoggle">menu</button>
            <div id="navbartoggle" class="collapse navbar-collapse navbar-center navbar-main-collapse">
                <form action="LogoutServlet" method="post">
                    <input type="submit" role="button" value="Logout" id="logout" class="form-control btn btn-info note-input">
                </form>
                <a href="EditProfile.jsp" id="edit" role="button" class="form-control btn btn-info note-input" >Edit profile</a>
                <a href="AboutUs.jsp" id="about" role="button" type="button" class="form-control btn btn-info note-input" >About us</a>
                <a href="User.jsp" id="user" role="button" class="form-control btn btn-info note-input" >User</a>
            </div>

            <br style="clear: both;" />
        </nav>
        <div>
            <div id="mainsignin" style="float: right; margin-right: 20%">
                <h1> Change Email </h1>
                <form role="form" method="post" class="signin-form" name="signup" onsubmit="return changeEmail()" action="/NotMalware/EditProfile.jsp">
                    <div class="form-group">
                        <label class="sr-only" for="form-password" >Password</label>
                        <input type="password" name="fpass1" placeholder="Password..." class="form-password" id="fpass">
                    </div>
                    <div class="form-group">
                        <label class="sr-only" for="form-email" >Email</label>
                        <input type="email" name="femail1" placeholder="New Email..." class="form-email" id="femail1">
                    </div>
                    <div class="form-group">
                        <label class="sr-only" for="form-email" >Email</label>
                        <input type="email" name="femail2" placeholder="Repeat New Email..." class="form-email" id="femail2">
                    </div>
                    <input type="submit" value="Change Email" class="form-control btn btn-info note-input landingbuttons" style="width:160px;">
                </form>
            </div>
            <div id="mainsignin" style="float: left; margin-left: 20%">
                <h1> Change Pass </h1>
                <form role="form" method="post" class="signin-form" name="signup" onsubmit="return changePass()" action="/NotMalware/EditProfile.jsp">
                    <div class="form-group">
                        <label class="sr-only" for="form-password" >Password</label>
                        <input type="password" name="fpass1" placeholder="Password..." class="form-password" id="fpass1">
                    </div>
                    <div class="form-group">
                        <label class="sr-only" for="form-password" >Password</label>
                        <input type="password" name="fpass2" placeholder="New Password..." class="form-password" id="fpass2">
                    </div>
                    <div class="form-group">
                        <label class="sr-only" for="form-password" >Password</label>
                        <input type="password" name="fpass3" placeholder="Repeat New Password..." class="form-password" id="fpass3">
                    </div>
                    <input type="submit" value="Change password" class="form-control btn btn-info note-input landingbuttons" style="width:160px;">
                </form>
            </div>
        </div>
        <div id="footer">
            <p>Copyrights © NotMalware</p>
        </div>
    </body>
</html>
