<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<html>
    <head>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" type="text/css" href="css/css.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <title>NotMalware</title>

        <%
            String userName = null;
            Cookie[] cookies = request.getCookies();
            if (cookies != null) {
                for (Cookie cookie : cookies) {
                    if (cookie.getName().equals("user")) {
                        userName = cookie.getValue();
                    }
                }
            }
            if (userName == null) {
                response.sendRedirect("Landing.jsp");
            }
        %>

        <script>
            function changeEmail() {
                var username = '<%=userName%>';
                var email1 = document.getElementsByName('femail1');
                var email2 = document.getElementsByName('femail2');
                var pass = document.getElementsByName('fpass4');

                if (email1.value.length <= 0 || email2.value.length <= 0 || pass.value.length <= 0) {
                    alert("Form must be filled out");
                    return false;
                } else if (email1.value !== email2.value) {
                    alert("New emails do not match");
                    return false;
                }

                var string = email1.value;
                var curl = '/NotMalware/webresources/' + username + "/" + pass + "/email";
                $.ajax({
                    url = curl,
                    type = 'POST',
                    data: string,
                    contentType: 'text/plain',
                    success: function () {
                    }
                });
            }

            function changePass() {
                var username = '<%=userName%>';
                var pass = document.getElementsByName('fpass');
                var pass2 = document.getElementsByName('fpass2');
                var pass3 = document.getElementsByName('fpass3');

                if (pass.value.length <= 0 || pass2.value.length <= 0 || pass3.value.length <= 0) {
                    alert("Form must be filled out");
                    return false;
                } else if (pass2.value !== pass3.value) {
                    alert("New passwords do not match");
                    return false;
                }

                var string = pass.value;
                var curl = "/NotMalware/webresources/" + username + "/" + pass + "/password";
                
                $.ajax({
                    url = curl,
                    type = 'POST',
                    data: string,
                    contentType: 'text/plain',
                    success: function () {
                    }
                });

            }
        </script>

    </head>

    <body>


        <div id="header">
            <img src="css/img/logo.png" alt="Masterful design" id="logo">
            <form action="LogoutServlet" method="post">
                <input type="submit" role="button" value="Logout" id="logout" class="form-control btn btn-info note-input">
            </form>
            <a href="EditProfile.jsp" id="edit" role="button" class="form-control btn btn-info note-input" >Edit profile</a>
            <a href="AboutUs.jsp" id="about" role="button" type="button" class="form-control btn btn-info note-input" >About us</a>
            <a href="User.jsp" id="user" role="button" class="form-control btn btn-info note-input" >User</a>

            <br style="clear: both;" />
        </div>

        <div id="maineditprofile">
            <h2>Change Password or Email</h2>
            <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myPasswordModal">Change Password</button>
            <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myEmailModal">Change Email</button>


            <div class="modal fade" id="myPasswordModal" role="dialog">
                <div class="modal-dialog modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Change Password</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="sr-only" for="form-password">Current Password</label>
                                <input type="password" name="fpass" placeholder="Current password..." class="form-password" id="form-password">
                            </div>
                            <div class="form-group">
                                <label class="sr-only" for="form-password">New Password</label>
                                <input type="password" name="fpass2" placeholder="New password..." class="form-password" id="form-password">
                            </div>
                            <div class="form-group">
                                <label class="sr-only" for="form-password">Repeat New Password</label>
                                <input type="password" name="fpass3" placeholder="Repeat New password..." class="form-password" id="form-password">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Confirm</button>
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="myEmailModal" role="dialog">
                <div class="modal-dialog modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Change Email</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="sr-only" for="form-email">Current Password</label>
                                <input type="email" name="fpass4" placeholder="Password" class="form-email" id="form-email">
                            </div>
                            <div class="form-group">
                                <label class="sr-only" for="form-email">New Email</label>
                                <input type="email" name="femail" placeholder="New email..." class="form-email" id="form-email">
                            </div>
                            <div class="form-group">
                                <label class="sr-only" for="form-email">Repeat New Email</label>
                                <input type="email" name="femail2" placeholder="Repeat New email..." class="form-email" id="form-email">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Confirm</button>
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer">
            <p>Copyrights © NotMalware</p>
        </div>
    </body>
</html>
